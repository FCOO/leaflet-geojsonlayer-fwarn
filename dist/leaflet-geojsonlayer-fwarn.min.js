!function(a,b,c,d){"use strict";var e=function(a,b,c){var d,e="DD-MMM-YY HH:mm",f=moment.utc(a),g="da"==b?"lokal":"local";return d="local"==c?f.local().format(e)+"&nbsp;("+g+")":f.utc().format(e)+"&nbsp;(UTC)"},f=function(a,b,c,d,f){return a.replace(b,e(c,d,f))},g=a.Class.extend({initialize:function(a,b){this.feature=a,this.geoJSON_Fwarn=b},updatePopup:function(a){function c(a){for(var b=[],c=[],d=0;d<a[0].length;d++)b.push(a[0][d][1]),c.push(a[0][d][0]);return b=b.sort(function(a,b){return a-b}),c=c.sort(function(a,b){return a-b}),[[b[0],c[0]],[b[b.length-1],c[c.length-1]]]}function d(a){var b={};for(var c in a)b[c]=a[c][m];return b}function e(a){for(var b in a)k=k.replace(new RegExp("{"+b+"}","g"),a[b])}var g,h=this.geoJSON_Fwarn.options,i=this.feature,j=h.template,k=j.popup,l=h.text,m=h.language||"da",n=a.getLatLng(),o={type:"Point",coordinates:[n.lng,n.lat]},p=i.geometry.coordinates,q="",r="";for(g in p)if("[object Array]"===Object.prototype.toString.call(p[g])){var s,t={type:"Polygon",coordinates:p[g]},u=b.gju.pointInPolygon(o,t),v=c(t.coordinates),w=b.gju.pointInBoundingBox(o,v);if(u||w){var x=i.properties,y=x.name[g],z=j.area.replace("{name}",y),A="",B=0;for(s in x.warnings[g]){B++;var C=x.warnings[g][s];A+=j.period,A=f(A,"{warningStartTime}",C.warningStartTime,m,h.timezone),A=f(A,"{warningEndTime}",C.warningEndTime,m,h.timezone)}z=z.replace("{periods}",A),B>1&&(l.header_period=l.header_periods);var D="";for(s in x.textInfo[g]){var E=x.textInfo[g][s];D+='<div class="detail"><strong>'+E.header+"</strong><br>"+E.body+"</div>"}z=z.replace("{informations}",D||"NO INFO"),u?q+=z:w&&(r+=z)}}return""===q&&(q=r),e({areas:q}),e(d(l)),e({click:"onClick=\"this.className = this.className=='open'?'closed':'open';\""}),k}});return a.GeoJSON.Fwarn=a.GeoJSON.extend({options:{language:"en",timezone:"local",protocol:b.location.protocol,baseurl:"//app.fcoo.dk/warnings/fwarn/fwarn_{language}.json",style:{weight:2,color:"#e2007a",opacity:1,fillColor:"#e2007a",fillOpacity:.2,fillRule:"nonzero"},template:{popup:'<div class="fwarn"><h1>{header}</h1><div class="container">{areas}</div><hr><p>{source}</p></div>',area:'<h2 class="open" {click}>{name}</h2><div class="area"><h3 class="open" {click}>{header_period}</h3><div class="inner">{periods}</div><h3 class="closed" {click}>{header_information}</h3><div class="inner">{informations}</div></div>',period:'<div class="detail period"><strong>{from}</strong> {warningStartTime}<br><strong>{to}</strong> {warningEndTime}</div>'},text:{header:{da:"Skydevarsler",en:"Firing warnings"},source:{da:'Kilde: <a target="_new" href="http://www.soefartsstyrelsen.dk">SÃ¸fartsstyrelsen</a>',en:'Source: <a target="_new" href="http://dma.dk">Danish Maritime Authority</a>'},header_information:{da:"Yderligere information",en:"Further information (in Danish)"},local:{da:"lokal",en:"local"},header_period:{da:"Periode",en:"Period"},header_periods:{da:"Perioder",en:"Periods"},from:{da:"Fra",en:"From"},to:{da:"Til",en:"To&nbsp;&nbsp;"}}},initialize:function(b){var c=this;a.setOptions(this,b),this._layers={},this.options.url=this.options.protocol+this.options.baseurl.replace("{language}","da"),this.jqxhr=$.getJSON(this.options.url),this.jqxhr.done(function(a){c.addData(a)}),this.options.onEachFeature=function(a,b){var d=new g(a,c);b.bindPopup("",{maxWidth:300,maxHeight:400,getContent:d.updatePopup,context:d})}},onAdd:function(b){var c=this;this.jqxhr.done(function(){a.GeoJSON.prototype.onAdd.call(c,b)}),b.on("timezonechange",function(a){c.options.timezone=a.timezone})}}),a.GeoJSON.Fwarn}(L,this,document);