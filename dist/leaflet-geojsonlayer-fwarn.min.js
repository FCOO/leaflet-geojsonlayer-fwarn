!function(a,b,c,d){"use strict";function e(a){for(var b=[],c=[],d=0;d<a[0].length;d++)b.push(a[0][d][1]),c.push(a[0][d][0]);return b=b.sort(function(a,b){return a-b}),c=c.sort(function(a,b){return a-b}),[[b[0],c[0]],[b[b.length-1],c[c.length-1]]]}var f=function(a,b,c){var d,e="DD-MMM-YY HH:mm",f=moment.utc(a),g="da"==b?"lokal":"local";return d="local"==c?f.local().format(e)+"&nbsp;("+g+")":f.utc().format(e)+"&nbsp;(UTC)"},g=function(a,b,c,d,e){return a.replace(b,f(c,d,e))},h=function(a,b,c){return a.replace(new RegExp(b,"g"),c)},i=[{search:"{HEADER}",da:"Skydevarsler",en:"Firing warnings"},{search:"{SOURCE}",da:'Kilde: <a target="_new" href="http://www.soefartsstyrelsen.dk">SÃ¸fartsstyrelsen</a>',en:'Source: <a target="_new" href="http://dma.dk">Danish Maritime Authority</a>'},{search:"{INFORMATION}",da:"Yderligere information",en:"Further information (in Danish)"},{search:"{LOCAL}",da:"lokal",en:"local"},{search:"{PERIOD}",da:"Period(er)",en:"Period(s)"},{search:"{FROM}",da:"Fra",en:"From"},{search:"{TO}",da:"Til",en:"To&nbsp;&nbsp;"}],j={popup:'<div class="fwarn"><h1>{HEADER}</h1><div class="container">{areas}</div><hr><p>{SOURCE}</p></div>',area:'<h2 class="open" {CLICK}>{name}</h2><div class="area"><h3 class="open" {CLICK}>{PERIOD}</h3><div class="inner">{periods}</div><h3 class="closed" {CLICK}>{INFORMATION}</h3><div class="inner">{informations}</div></div>',period:'<div class="detail period"><strong>{FROM}</strong> {warningStartTime}<br><strong>{TO}</strong> {warningEndTime}</div>'};return a.GeoJSON.Fwarn=a.GeoJSON.extend({options:{language:"en",timezone:"local",protocol:b.location.protocol,baseurl:"//app.fcoo.dk/warnings/fwarn/fwarn_{language}.json",style:{weight:2,color:"#e2007a",opacity:1,fillColor:"#e2007a",fillOpacity:.2,fillRule:"nonzero"}},initialize:function(c){var f=this;a.setOptions(this,c),this._layers={},this.options.url=this.options.protocol+this.options.baseurl.replace("{language}","da"),this.jqxhr=$.getJSON(this.options.url),this.jqxhr.done(function(a){f.addData(a)}),this.options.onEachFeature=function(a,c){c.on({click:function(a){var k,l=a.latlng,m={type:"Point",coordinates:[l.lng,l.lat]},n=c.feature.geometry.coordinates,o=j.popup,p="",q="";for(k in n)if("[object Array]"===Object.prototype.toString.call(n[k])){var r,s={type:"Polygon",coordinates:n[k]},t=b.gju.pointInPolygon(m,s),u=e(s.coordinates),v=b.gju.pointInBoundingBox(m,u);if(t||v){var w=c.feature.properties,x=w.name[k],y=j.area.replace("{name}",x),z="";for(r in w.warnings[k]){var A=w.warnings[k][r];z+=j.period,z=g(z,"{warningStartTime}",A.warningStartTime,f.options.language,f.options.timezone),z=g(z,"{warningEndTime}",A.warningEndTime,f.options.language,f.options.timezone)}y=y.replace("{periods}",z);var B="";for(r in w.textInfo[k]){var C=w.textInfo[k][r];B+='<div class="detail"><strong>'+C.header+"</strong><br>"+C.body+"</div>"}y=y.replace("{informations}",B||"NO INFO"),t?p+=y:v&&(q+=y)}}for(""===p&&(p=q),o=o.replace("{areas}",p),k=0;k<i.length;k++){var D=$(i[k]).attr("search");typeof D!=typeof d&&D!==!1&&(o=h(o,i[k].search,i[k][f.options.language]))}o=h(o,"{CLICK}","onClick=\"this.className = this.className=='open'?'closed':'open';\""),c._map.openPopup(o,l,{maxWidth:300,maxHeight:240})}})}},onAdd:function(b){var c=this;this.jqxhr.done(function(){a.GeoJSON.prototype.onAdd.call(c,b)}),b.on("timezonechange",function(a){c.options.timezone=a.timezone})}}),a.GeoJSON.Fwarn}(L,this,document);